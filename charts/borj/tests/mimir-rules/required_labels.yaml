groups:

  - name: KubernetesMicroservice
    rules:

      - alert: KubernetesDeploymentReplicasMismatch
        expr: |
          (
            kube_deployment_spec_replicas > kube_deployment_status_replicas_available
          ) 
          and 
          (
            changes(kube_deployment_status_replicas_updated[10m]) == 0
          ) 
        for: 60m
        labels:
          send_to: devops
          severity: warning
        annotations:
          description: "Deployment {{ ` {{ $labels.namespace }} ` }}/{{ ` {{ $labels.deployment }} ` }} has not matched the expected number of replicas for longer than 15 minutes."
          title: "[{{ ` {{ $labels.cluster }} ` }}/{{ ` {{ $labels.namespace }} ` }}] Deployment [{{ ` {{ $labels.deployment }} ` }}] has not matched the expected number of replicas."
        auxiliary:
          dashboards:
            - kubernetes-essentials-pods
          required_labels:
            - cluster
            - namespace
            - pod